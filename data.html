<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <title>Giacomo Boscaini-Gilroy</title>
  <meta name='viewport' content='initial-scale=1' />
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,bold" rel="stylesheet">
  <link href="./css/style-chosen.css" rel="stylesheet" />

<style>

  a {
    text-decoration: none;
    color: black;
  }

  body {
    font-family: 'Open Sans';
    display: inline-block;
    margin: 0px;
  }

  h3, p {
    float: left;
    margin: 15px 0px 0px 0px;
  }

  h3 {
    font-size: 14pt;
  }

  p {
    font-size: 12pt;
  }

  .column > img {
    /* display: inline-block; */
    float: right;
  }

  a > p {
    margin: 5px 0px 0px 30px;
    display: inline-block;
  }

  .presvg {
    /* clear: both; */
    /* display: block; */
    margin-left: 30px;
    margin-bottom: 30px;
    font-size: 14pt;
  }

  .row {
    clear: both;
  }

  /* .column {
    float: left;
    width: 30%;
  } */

  .container {
    float: left;
  }

  .flex-container {
    display: flex;
    flex-direction: column;
  }

  .row {
    display: flex;
    flex-direction: row;
  }

  .row > * {
    flex: 1 1 0;
  }
  .row :first-child {
    flex: 1 1 0;
  }

  svg {
    float: left;
    /* clear: both; */
    width: 30px;
    height: 1000px;
    /* margin: 0 auto; */
    /* display: inline-block; */
  }

  text {
    text-anchor: middle;
    alignment-baseline: middle;
  }

</style>

<!-- <script src="https://cdn.ons.gov.uk/vendor/d3/4.2.7/d3.min.js"></script> -->
<script src="lib/d3.min.js"></script>

<body>
  <a href="index.html">
    <p style="font-size: 30px;">‚Üê</p>
  </a>
  <div class="row">
    <p class="presvg">I find and communicate stories in data</p>
  </div>

  <div class="container">
    <svg id="paths">
    </svg>
    <div class="flex-container">
      <h3>Office for National Statistics</h3>

      <div class="row">
        <div class="column">
          <p>We make statistics accessible to the general public with engaging interactive content...</p>
        </div>
        <div class="column">
          <a href="https://www.ons.gov.uk/peoplepopulationandcommunity/birthsdeathsandmarriages/deaths/articles/comparisonsofallcausemortalitybetweeneuropeancountriesandregions/januarytojune2020">
            <img src="dataimg.png" width="100%"></img>
          </a>
        </div>
        <div class="column">
          <a href="">
            <img src="popprofiles.png" width="100%"></img>
          </a>
        </div>
        <div class="column">
          <a href="https://www.ons.gov.uk/peoplepopulationandcommunity/healthandsocialcare/causesofdeath/articles/deathsduetocovid19interactivemap/2021-02-25">
            <img src="mortality.png" width="100%"></img>
          </a>
        </div>
        <!-- <div class="column">
          <a href="https://giacomobg.github.io/onshhcomp/map/">
            <img src="householdcomposition.png" width="100%"></img>
          </a>
        </div> -->
      </div>

      <div class="row">
        <div class="column">
          <p>...and by making ordinary charts more understandable.</p>
        </div>
        <div class="column">
          <a href="https://www.ons.gov.uk/economy/nationalaccounts/balanceofpayments/articles/ukforeigndirectinvestmenttrendsandanalysis/november2020">
            <img src="bump.png" width="100%"></img>
          </a>
        </div>
        <div class="column">
          <a href="https://www.ons.gov.uk/peoplepopulationandcommunity/birthsdeathsandmarriages/deaths/articles/recenttrendsinsuicidedeathoccurrencesinenglandandwalesbetween2001and2018/2020-12-08">
            <img src="suicides.png" width="100%"></img>
          </a>
        </div>
        <div class="column">
          <a href="https://www.ons.gov.uk/peoplepopulationandcommunity/birthsdeathsandmarriages/ageing/articles/livinglonger/implicationsofchildlessnessamongtomorrowsolderpopulation">
            <img src="childlesswomen.png" width="100%"></img>
          </a>
        </div>
      </div>

    </div>
  </div>

</body>

<script>

  var svg = d3.select("#paths");
  var svgMidpoint = parseInt(svg.style("width"))/2;
  var data = [100,-100,100,-100];
  var buttonsData = [
    {
      text: "Data",
      x: -100,
      href: "data.html",
      image: "dataimg.png"
    },
    {
      text: "Art",
      x: 100,
      href: "art.html",
      image: "artimg.jpg"
    }
  ];
  var circleId = 0;
  var firstAnimation = [true, true, true, true];




  // run it
  createButtons();
  createCircles();
  data.forEach(function(item, i) { moveCircleToStartByNum(i); });
  setInterval(repeat, 4000);
  addSvgMouseBehaviour();


  function createButtons() {

    // create buttons
    var links = svg.selectAll("a")
      .data(buttonsData)
      .enter()
      // create a containers
      .append("a")
      .attr("href", function(d) { return d.href })

    // put text in a containers
    links.append("text")
      .attr("x", function(d) { return d.x + svgMidpoint })
      .attr("y", 250)
      .attr("dy", "0.4em")
      .text(function(d) { return d.text })

    // add boxes below
    var rectWidth = 150
    links.append("image")
      .attr("id", function(d,i) { return "link-rect" + i })
      .classed("link-rect", true)
      .attr("x", function(d) { return d.x + svgMidpoint - rectWidth/2})
      .attr("y", 270)
      .attr("width", rectWidth)
      .attr("height", 0)
      .attr("href", function(d) { return d.image })
      .attr("preserveAspectRatio", "xMidYMax slice") // xMidYMin can work too
      // .attr("fill", function(d,i) { return "url(#img" + i + ")" } );
  }

  function createCircles() {

    // create circles
    circles = svg.selectAll("circle")
      .data(data)
      .enter()
      .append("circle")
      .attr("id", function(d,i) { return "circle" + i })
      .attr("r", 4)
      .attr("opacity", 0)

  } // end create


  function moveCircleToStart() {
    moveCircleToStartByNum(circleId);
  }

  function moveCircleToStartByNum(num) {
    d3.select("#circle"+num)
      .attr("cx", svgMidpoint)
      .attr("cy", 10);
  }

  function transitionCircle() {
    var duration = 16000;
    var fadeOutDelay = 800;

    // fade out
    d3.select("#circle"+circleId)
      .transition("opacity")
      .duration(duration - fadeOutDelay)
      .on("end", function() {
        d3.select(this)
          .transition()
          .duration(fadeOutDelay)
          .attr("opacity", 0);
      });

    // d3.select("#circle"+circleId)
    //   .transition("tx")
    //   .ease(d3.easeCubicInOut)
    //   .duration(duration)
    //   .attr("cx", function(d) { return svgMidpoint + d } )
    //   .on("end", function() {
    //     d3.select(this)
    //       .attr("cx", svgMidpoint)
    //       .transition()
    //       .duration(1000)
    //       .attr("opacity", 1);
    //   });

    // transition y
    d3.select("#circle"+circleId)
      .transition("ty")
      .ease(d3.easeLinear)
      .duration(duration)
      .attr("cy", 500)
      .on("end", function() {
        d3.select(this)
          .attr("cy", 10)
          .transition()
          .duration(1000)
          .attr("opacity", 1);
      });

  }

  function repeat() {
    transitionCircle();

    if (firstAnimation[circleId]) {
      d3.select("#circle" + circleId)
        .transition()
        .duration(700)
        .attr("opacity", 1);
      firstAnimation[circleId] = false;
    }

    circleId = (circleId + 1) % data.length;

  }

  function addSvgMouseBehaviour() {

    var coordinates = [];
    var maxRectHeight = 120;
    var linkRect0 = d3.select("#link-rect0")
    var linkRect1 = d3.select("#link-rect1")

    svg.on("mousemove", function(d) {
      coordinates = d3.mouse(this);
      var x = coordinates[0];
      var y = coordinates[1];
      var distanceFromButton1 = Math.sqrt( (x-(svgMidpoint-100))*(x-(svgMidpoint-100)) + (y-330)*(y-330) );
      var distanceFromButton2 = Math.sqrt( (x-(svgMidpoint+100))*(x-(svgMidpoint+100)) + (y-330)*(y-330) );
      linkRect0.attr("height", Math.min( Math.max(0, ((maxRectHeight+30)/6)*(distanceFromButton2 - distanceFromButton1)/distanceFromButton1 - 15 ), maxRectHeight ))
      linkRect1.attr("height", Math.min( Math.max(0, ((maxRectHeight+30)/6)*(distanceFromButton1 - distanceFromButton2)/distanceFromButton2 - 15 ), maxRectHeight ))
      // console.log(distanceFromButton1, distanceFromButton2)

    })
  }



</script>
